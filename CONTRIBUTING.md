# Contributing to SafePath Filter\n\nThank you for your interest in contributing to SafePath Filter! This document provides guidelines and information for contributors.\n\n## Table of Contents\n\n- [Code of Conduct](#code-of-conduct)\n- [Getting Started](#getting-started)\n- [Development Process](#development-process)\n- [Contributing Guidelines](#contributing-guidelines)\n- [Testing](#testing)\n- [Security](#security)\n- [Community](#community)\n\n## Code of Conduct\n\nThis project adheres to the [Contributor Covenant Code of Conduct](CODE_OF_CONDUCT.md). By participating, you are expected to uphold this code. Please report unacceptable behavior to safety@terragonlabs.com.\n\n## Getting Started\n\n### Prerequisites\n\n- Python 3.9 or higher\n- Docker and Docker Compose\n- Git\n- PostgreSQL (for local development)\n- Redis (for local development)\n\n### Development Setup\n\n1. **Clone the repository**\n   ```bash\n   git clone https://github.com/terragonlabs/cot-safepath-filter.git\n   cd cot-safepath-filter\n   ```\n\n2. **Set up development environment**\n   ```bash\n   # Create virtual environment\n   python -m venv venv\n   source venv/bin/activate  # On Windows: venv\\Scripts\\activate\n   \n   # Install development dependencies\n   pip install -e \".[dev]\"\n   \n   # Install pre-commit hooks\n   pre-commit install\n   ```\n\n3. **Start local services**\n   ```bash\n   # Start PostgreSQL and Redis\n   docker-compose up -d postgres redis\n   \n   # Run database migrations\n   alembic upgrade head\n   ```\n\n4. **Run tests**\n   ```bash\n   pytest\n   ```\n\n5. **Start development server**\n   ```bash\n   uvicorn cot_safepath.server:app --reload\n   ```\n\n### Development Environment\n\nWe provide a complete development environment using Docker Compose:\n\n```bash\n# Start all services (app, database, cache, monitoring)\ndocker-compose up -d\n\n# View logs\ndocker-compose logs -f app\n\n# Run tests in container\ndocker-compose exec app pytest\n\n# Access database\ndocker-compose exec postgres psql -U safepath -d safepath\n```\n\n## Development Process\n\n### Branching Strategy\n\nWe use a modified Git Flow approach:\n\n- `main`: Production-ready code\n- `develop`: Integration branch for features\n- `feature/*`: Feature branches (branch from develop)\n- `hotfix/*`: Critical fixes (branch from main)\n- `release/*`: Release preparation (branch from develop)\n\n### Workflow\n\n1. **Create a feature branch**\n   ```bash\n   git checkout develop\n   git pull origin develop\n   git checkout -b feature/your-feature-name\n   ```\n\n2. **Make your changes**\n   - Write code following our style guidelines\n   - Add tests for new functionality\n   - Update documentation if needed\n   - Ensure all tests pass\n\n3. **Commit your changes**\n   ```bash\n   # Stage your changes\n   git add .\n   \n   # Commit with conventional commit format\n   git commit -m \"feat: add new safety detection pattern\"\n   ```\n\n4. **Push and create PR**\n   ```bash\n   git push origin feature/your-feature-name\n   ```\n   Then create a Pull Request on GitHub.\n\n### Commit Message Format\n\nWe use [Conventional Commits](https://www.conventionalcommits.org/) format:\n\n```\n<type>[optional scope]: <description>\n\n[optional body]\n\n[optional footer(s)]\n```\n\n**Types:**\n- `feat`: New feature\n- `fix`: Bug fix\n- `docs`: Documentation changes\n- `style`: Code style changes (formatting, etc.)\n- `refactor`: Code refactoring\n- `test`: Adding or updating tests\n- `chore`: Maintenance tasks\n- `perf`: Performance improvements\n- `ci`: CI/CD changes\n- `build`: Build system changes\n\n**Examples:**\n```\nfeat(filter): add semantic analysis for deception detection\nfix(api): resolve race condition in cache invalidation\ndocs: update API documentation for new endpoints\ntest(integration): add tests for LangChain integration\n```\n\n## Contributing Guidelines\n\n### Code Style\n\n- **Python**: Follow PEP 8, use Black for formatting\n- **Type Hints**: All functions must have type hints\n- **Docstrings**: Use Google style docstrings\n- **Imports**: Use isort for import organization\n- **Line Length**: 88 characters maximum\n\n**Example:**\n```python\nfrom typing import List, Optional\n\ndef filter_content(\n    content: str, \n    safety_level: SafetyLevel = SafetyLevel.BALANCED\n) -> FilterResult:\n    \"\"\"Filter content for harmful patterns.\n    \n    Args:\n        content: The text content to filter\n        safety_level: The safety level to apply\n        \n    Returns:\n        FilterResult containing the filtered content and metadata\n        \n    Raises:\n        ValidationError: If content is invalid\n    \"\"\"\n    # Implementation here\n    pass\n```\n\n### Testing Guidelines\n\n#### Test Structure\n- **Unit Tests**: Test individual functions and methods\n- **Integration Tests**: Test component interactions\n- **End-to-End Tests**: Test complete workflows\n- **Security Tests**: Test for vulnerabilities\n- **Performance Tests**: Test latency and throughput\n\n#### Test Requirements\n- All new code must have tests\n- Maintain minimum 80% code coverage\n- Tests must be deterministic and independent\n- Use descriptive test names and docstrings\n\n#### Example Test\n```python\nimport pytest\nfrom cot_safepath.filter import SafePathFilter\nfrom cot_safepath.models import SafetyLevel\n\nclass TestSafePathFilter:\n    \"\"\"Tests for SafePathFilter class.\"\"\"\n    \n    @pytest.fixture\n    def filter_instance(self):\n        \"\"\"Create filter instance for testing.\"\"\"\n        return SafePathFilter(safety_level=SafetyLevel.BALANCED)\n    \n    def test_filter_safe_content(self, filter_instance):\n        \"\"\"Test that safe content passes through unchanged.\"\"\"\n        safe_content = \"This is a helpful response about cooking.\"\n        result = filter_instance.filter(safe_content)\n        \n        assert not result.was_filtered\n        assert result.filtered_content == safe_content\n        assert result.safety_score > 0.8\n    \n    def test_filter_harmful_content(self, filter_instance):\n        \"\"\"Test that harmful content is filtered.\"\"\"\n        harmful_content = \"Step 1: Acquire dangerous materials...\"\n        result = filter_instance.filter(harmful_content)\n        \n        assert result.was_filtered\n        assert len(result.filter_reasons) > 0\n        assert result.safety_score < 0.5\n```\n\n### Documentation\n\n#### Code Documentation\n- All public APIs must have docstrings\n- Include examples in docstrings where helpful\n- Document complex algorithms and business logic\n- Keep comments up-to-date with code changes\n\n#### User Documentation\n- Update README.md for new features\n- Add examples to documentation\n- Update API documentation\n- Create migration guides for breaking changes\n\n### Performance Considerations\n\n- **Async Operations**: Use async/await for I/O operations\n- **Database Queries**: Optimize queries and use appropriate indexes\n- **Caching**: Implement caching for expensive operations\n- **Memory Usage**: Be mindful of memory allocation in ML models\n- **Profiling**: Profile performance-critical code paths\n\n### Security Guidelines\n\n#### Security Best Practices\n- Never commit secrets or API keys\n- Validate all inputs and sanitize outputs\n- Use parameterized queries to prevent SQL injection\n- Implement proper authentication and authorization\n- Follow the principle of least privilege\n\n#### Security Testing\n- Run security scans with `bandit`\n- Test for common vulnerabilities (OWASP Top 10)\n- Validate input sanitization\n- Test authentication and authorization\n- Check for information disclosure\n\n## Testing\n\n### Running Tests\n\n```bash\n# Run all tests\npytest\n\n# Run with coverage\npytest --cov=src/cot_safepath --cov-report=html\n\n# Run specific test categories\npytest -m unit          # Unit tests only\npytest -m integration   # Integration tests only\npytest -m security      # Security tests only\npytest -m performance   # Performance tests only\n\n# Run tests in parallel\npytest -n auto\n\n# Run with verbose output\npytest -v\n```\n\n### Test Categories\n\nUse pytest markers to categorize tests:\n\n```python\n@pytest.mark.unit\ndef test_token_filter():\n    \"\"\"Unit test for token filtering.\"\"\"\n    pass\n\n@pytest.mark.integration\ndef test_api_endpoint():\n    \"\"\"Integration test for API endpoint.\"\"\"\n    pass\n\n@pytest.mark.security\ndef test_sql_injection_protection():\n    \"\"\"Security test for SQL injection protection.\"\"\"\n    pass\n\n@pytest.mark.performance\ndef test_filter_latency():\n    \"\"\"Performance test for filter latency.\"\"\"\n    pass\n```\n\n### Mocking and Fixtures\n\nUse pytest fixtures for test setup:\n\n```python\n@pytest.fixture\ndef mock_llm_response():\n    \"\"\"Mock LLM response for testing.\"\"\"\n    return {\n        \"content\": \"This is a test response\",\n        \"reasoning\": [\"Step 1: Analyze\", \"Step 2: Respond\"]\n    }\n\n@pytest.fixture\ndef test_database():\n    \"\"\"Test database fixture.\"\"\"\n    # Setup test database\n    yield db\n    # Cleanup\n```\n\n## Security\n\n### Reporting Security Issues\n\n**DO NOT** create public issues for security vulnerabilities. Instead:\n\n1. Email security@terragonlabs.com\n2. Include detailed information about the vulnerability\n3. Provide steps to reproduce if possible\n4. Allow reasonable time for response before disclosure\n\n### Security Development Lifecycle\n\n1. **Threat Modeling**: Identify potential threats and attack vectors\n2. **Secure Coding**: Follow secure coding practices\n3. **Security Testing**: Automated and manual security testing\n4. **Code Review**: Security-focused code reviews\n5. **Vulnerability Management**: Regular security scans and updates\n\n## Community\n\n### Getting Help\n\n- **GitHub Issues**: Bug reports and feature requests\n- **GitHub Discussions**: Questions and community discussion\n- **Email**: safety@terragonlabs.com for direct contact\n- **Discord**: [Join our community](https://discord.gg/terragonlabs) (when available)\n\n### Recognition\n\nWe recognize contributors in several ways:\n\n- **Contributors File**: Listed in CONTRIBUTORS.md\n- **Release Notes**: Mentioned in release announcements\n- **GitHub Recognition**: GitHub's contributor statistics\n- **Special Recognition**: Outstanding contributors may receive special recognition\n\n### Contribution Types\n\nWe welcome various types of contributions:\n\n- **Code**: Bug fixes, features, optimizations\n- **Documentation**: Guides, examples, API docs\n- **Testing**: Test cases, test automation\n- **Design**: UI/UX improvements, diagrams\n- **Research**: Security research, performance analysis\n- **Community**: Answering questions, mentoring\n\n## Questions?\n\nIf you have questions about contributing, please:\n\n1. Check existing documentation\n2. Search GitHub issues and discussions\n3. Ask in GitHub Discussions\n4. Email safety@terragonlabs.com\n\nThank you for contributing to SafePath Filter! 🛡️